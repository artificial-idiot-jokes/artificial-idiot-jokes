<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Artificial Idiot â€” Jokes & Riddles</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="wrap">
    <header class="hero">
      <div class="emoji">ðŸ¤–</div>
      <h1>Artificial Idiot</h1>
      <p class="sub">Jokes & Riddles (offline or OpenRouter)</p>
    </header>

    <section class="card">
      <div class="tabs">
        <label class="tab">
          <input type="radio" name="mode" value="riddles" checked />
          <span>Riddles</span>
        </label>
        <label class="tab">
          <input type="radio" name="mode" value="antijokes" />
          <span>Anti-jokes</span>
        </label>
      </div>

      <div class="controls">
        <input id="topic" type="text" placeholder="Give me a topic (optional)â€¦" />
        <button id="go">Generate</button>
      </div>

      <pre id="out" class="output" aria-live="polite"></pre>

      <div class="hint">
        <code class="endpoint">/.netlify/functions/jokebot</code>
      </div>
    </section>

    <footer class="foot">
      <small>Â© Artificial Idiot â€” client UI + serverless brain</small>
    </footer>
  </main>

  <script>
    const goBtn = document.getElementById('go');
    const out = document.getElementById('out');
    const topic = document.getElementById('topic');

    function selectedCategory() {
      const checked = document.querySelector('input[name="mode"]:checked');
      return checked ? checked.value : 'riddles';
    }

    function show(text) {
      out.textContent = text;
    }

    goBtn.addEventListener('click', async () => {
      goBtn.disabled = true;
      show('Thinkingâ€¦');

      try {
        const body = {
          category: selectedCategory(),
          topic: topic.value.trim() || null
        };

        const res = await fetch('/.netlify/functions/jokebot', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          const msg = data && (data.error || data.message || data.details);
          throw new Error(msg || `HTTP ${res.status}`);
        }

        if (data && data.text) {
          show(data.text);
        } else if (data && data.answer && data.setup) {
          show(`${data.setup} ${data.answer}`);
        } else {
          show(JSON.stringify(data, null, 2));
        }
      } catch (err) {
        show(`Error: ${err.message || err}`);
      } finally {
        goBtn.disabled = false;
      }
    });

    window.addEventListener('load', () => goBtn.click());
  </script>
</body>
</html>
