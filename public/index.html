<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Artificial Idiot â€” Jokes & Riddles</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:#0b0f14;color:#e6edf3;margin:0;padding:24px}
    h1{font-size:40px;margin:0 0 6px}
    .card{background:#0f1621;border:1px solid #1e2633;border-radius:14px;padding:20px;max-width:780px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .modes{display:flex;gap:18px;margin:8px 0 14px}
    .output{min-height:180px;white-space:pre-wrap;background:#0b111b;border:1px dashed #2a3547;border-radius:10px;padding:16px;color:#cbd5e1}
    input[type="text"]{flex:1;min-width:220px;background:#0b111b;border:1px solid #2a3547;border-radius:10px;padding:12px 14px;color:#e6edf3}
    button{background:#2f6feb;border:none;border-radius:10px;color:#fff;padding:12px 18px;font-weight:600}
    .hint{opacity:.7;font-size:14px;margin-top:10px}
    .pill{display:inline-block;border:1px solid #233047;border-radius:999px;padding:8px 12px;cursor:pointer}
    .pill input{margin-right:6px}
    .endpoint{opacity:.7;font-size:13px;margin-top:10px}
  </style>
</head>
<body>
  <h1>ðŸ¤– Artificial Idiot</h1>
  <div class="card">
    <div class="modes">
      <label class="pill"><input type="radio" name="mode" value="riddle" checked> Riddles</label>
      <label class="pill"><input type="radio" name="mode" value="antijoke"> Anti-jokes</label>
    </div>

    <div class="row">
      <input id="topic" type="text" placeholder="Give me a topic (optional)â€¦" />
      <button id="go">Generate</button>
    </div>

    <div id="out" class="output"></div>
    <div class="endpoint">Serverless endpoint: <code>/.netlify/functions/jokebot</code></div>
  </div>

  <script>
    const out = document.getElementById('out');
    const go = document.getElementById('go');
    const topic = document.getElementById('topic');

    function getMode(){
      const el = document.querySelector('input[name="mode"]:checked');
      return el ? el.value : 'riddle';
    }

    function show(text){
      out.textContent = text;
    }

    async function run(){
      show('Thinkingâ€¦');
      try{
        const res = await fetch('/.netlify/functions/jokebot', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ mode: getMode(), topic: topic.value.trim() })
        });

        // Show raw text on non-JSON responses
        const text = await res.text();
        let data = null;
        try { data = JSON.parse(text); } catch {}

        if(!res.ok){
          // Try to extract a meaningful error
          if(data?.error){
            const msg = typeof data.error === 'string' ? data.error
              : data.error.message || data.error.details || JSON.stringify(data.error, null, 2);
            show('Error: ' + msg);
          }else{
            show('HTTP ' + res.status + ': ' + text);
          }
          return;
        }

        // Successful response parsing
        if(!data){
          show(text);
          return;
        }

        // OpenRouter chat-style shape
        let content =
          data.choices?.[0]?.message?.content ??
          data.output_text ??
          data.message?.content ??
          data.content;

        if(!content){
          // Fall back to pretty JSON if unexpected shape
          content = JSON.stringify(data, null, 2);
        }
        show(content);
      }catch(err){
        show('Client error: ' + (err?.message || err));
      }
    }

    go.addEventListener('click', run);
    topic.addEventListener('keydown', e => { if(e.key === 'Enter') run(); });
  </script>
</body>
</html>
